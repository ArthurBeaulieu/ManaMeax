!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){n(2),e.exports=n(1)},function(e,t,n){},function(e,t,n){"use strict";function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}n.r(t);var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ls=window.localStorage}var t,n,i;return t=e,(n=[{key:"save",value:function(e,t){this._ls.setItem(e,JSON.stringify(t))}},{key:"remove",value:function(e){}},{key:"get",value:function(e){return JSON.parse(this._ls.getItem(e))}}])&&s(t.prototype,n),i&&s(t,i),e}();function a(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._onEvent=t.onEvent,this._channels=[],this._input=null,this._output=null,this._knobLow=null,navigator.requestMIDIAccess?navigator.requestMIDIAccess().then(this.requestMIDIAccess.bind(this),this.requestMIDIAccessFailure):console.log("navigator.requestMIDIAccess undefined on this browser. Try on Chromium/Chrome."),this._setEventSubscriptions()}var t,n,s;return t=e,(n=[{key:"_setEventSubscriptions",value:function(){CustomEvents.subscribe("Player/CuePhones",this._sendMIDIRaw.bind(this)),CustomEvents.subscribe("Player/MasterCuePhones",this._sendMIDIRaw.bind(this))}},{key:"requestMIDIAccess",value:function(e){for(var t=this,n=e.inputs.values(),s=e.outputs.values(),i=n.next();i&&!i.done;i=n.next()){if("DDJ-400"===i.value.name){this._input=i,this._readJSONFile("./assets/json/".concat(i.value.name,".json")).then((function(e){t._channels=e.channels,i.value.onmidimessage=t.midiOnMIDImessage.bind(t),i.value.onstatechange=t.midiOnStateChange}));break}console.log("Unsupported device ".concat(i.value.name,", contact support@manazeak.org to support this device."))}for(var a=s.next();a&&!a.done;a=s.next())"DDJ-400"===a.value.name?this._output=a:console.log("Unsupported device ".concat(a.value.name,", contact support@manazeak.org to support this device."))}},{key:"sendMIDIMessage",value:function(e){console.trace(),this._output.value.send(e)}},{key:"midiOnMIDImessage",value:function(e){var t=this._parseMIDIArguments(e.data),n=this._retrieveElementFromDeviceMapping(t);if(n){n.args=t,n.raw=e.data;var s=this._buildMIDIEvent(n);s&&this._onEvent(s)}}},{key:"_parseMIDIArguments",value:function(e){return{type:240&event.data[0],cmd:event.data[0]>>4,channel:15&event.data[0],note:event.data[1],velocity:event.data[2]}}},{key:"_retrieveElementFromDeviceMapping",value:function(e){for(var t=null,n=0;n<this._channels.length;++n)for(var s=0;s<this._channels[n].channel.length;++s)if(e.channel===this._channels[n].channel[s].value){var i=this._findMatchingElementInChannel(e,this._channels[n]);i?((t=Object.assign({},i)).name="".concat(this._channels[n].name,"/").concat(i.name),t.id="".concat(Enums.Components[this._channels[n].channel[s].name]).concat(i.id)):console.log("Unmapped key",e);break}return t}},{key:"_findMatchingElementInChannel",value:function(e,t){for(var n=null,s=0;s<t.elements.length;++s)for(var i=0;i<t.elements[s].note.length;++i)if(e.note===t.elements[s].note[i]&&e.type===t.elements[s].type){n=t.elements[s];break}return n}},{key:"_buildMIDIEvent",value:function(e){e.value="";var t=e.elementType,n=e.args;if(t===Enums.ElementType.BUTTON)127===n.velocity?e.value="push":0===n.velocity&&(e.value="release");else if(t===Enums.ElementType.JOGWHEEL)65===n.velocity?e.value="increase":63===n.velocity&&(e.value="decrease");else if(t===Enums.ElementType.ROTARY)1===n.velocity?e.value="increase":127===n.velocity&&(e.value="decrease");else if(t===Enums.ElementType.SELECT)127===n.velocity?e.value="select":0===n.velocity&&(e=null);else if(t===Enums.ElementType.KNOB_LOW)this._knobLow=e,this._knobLow.args=n,e=null;else if(t===Enums.ElementType.KNOB_HIGH){var s=(127*this._knobLow.args.velocity+n.velocity)/16256;e.value=s,this._knobLow=null}return e}},{key:"_readJSONFile",value:function(e){return new Promise((function(t,n){try{var s=new XMLHttpRequest;s.overrideMimeType("application/json"),s.open("GET",e,!0),s.onreadystatechange=function(){4===s.readyState&&(200===s.status?t(JSON.parse(s.responseText)):n("Error when loading ".concat(e)))},s.send()}catch(t){n("Error when loading ".concat(e))}}))}},{key:"_sendMIDIRaw",value:function(e){this.sendMIDIMessage(e.raw)}},{key:"requestMIDIAccessFailure",value:function(e){console.log("requestMIDIAccessFailure",e)}},{key:"midiOnStateChange",value:function(e){console.log("midiOnStateChange",e,e.port.name+" "+e.port.state)}}])&&a(t.prototype,n),s&&a(t,s),e}();function r(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._audioCtx=null,this._nodes={leftGain:null,rightGain:null,outputGain:null},this._players={},this._leftPhoneCue=null,this._rightPhoneCue=null,this._gainValue=.7079,this._leftCue=!1,this._rightCue=!1,this._setuptNodes()}var t,n,s;return t=e,(n=[{key:"_setuptNodes",value:function(){this._audioCtx=new AudioContext,this._nodes.leftGain=this._audioCtx.createGain(),this._nodes.leftGain.gain.value=this._gainValue,this._nodes.rightGain=this._audioCtx.createGain(),this._nodes.rightGain.gain.value=this._gainValue,this._nodes.outputGain=this._audioCtx.createGain(),this._nodes.outputGain.gain.value=this._gainValue,this._nodes.leftGain.connect(this._nodes.outputGain),this._nodes.rightGain.connect(this._nodes.outputGain);var e=this._audioCtx.destination.maxChannelCount;this._nodes.merger=this._audioCtx.createChannelMerger(e),this._audioCtx.destination.channelCount=e,this._nodes.leftGain.connect(this._nodes.merger,0,0),this._nodes.rightGain.connect(this._nodes.merger,0,1),this._nodes.merger.connect(this._nodes.outputGain),this._nodes.outputGain.connect(this._audioCtx.destination)}},{key:"crossFade",value:function(e){e<.5?(this._nodes.leftGain.gain.value=1,this._nodes.rightGain.gain.value=2*e):e>.5?(this._nodes.leftGain.gain.value=1-2*(e-.5),this._nodes.rightGain.gain.value=1):.5===e&&(this._nodes.leftGain.gain.value=.5,this._nodes.rightGain.gain.value=.5),CustomEvents.publish("Player/Crossfade",{leftGain:this._nodes.leftGain.gain.value,rightGain:this._nodes.rightGain.gain.value,value:e})}},{key:"togglePhoneCue",value:function(e,t){"left"===e?!1===this._leftCue?(this._leftCue=!0,t.raw[2]=127):(this._leftCue=!1,t.raw[2]=0):"right"===e&&(!1===this._rightCue?(this._rightCue=!0,t.raw[2]=127):(this._rightCue=!1,t.raw[2]=0)),t.name=e,CustomEvents.publish("Player/CuePhones",t),!0===this._leftCue&&!0===this._rightCue?(this._leftPhoneCue&&this._rightPhoneCue&&(this._leftPhoneCue.disconnect(this._nodes.merger,0,2),this._rightPhoneCue.disconnect(this._nodes.merger,0,3)),this._leftPhoneCue=this._players.left.output,this._rightPhoneCue=this._players.right.output,this._leftPhoneCue.connect(this._nodes.merger,0,2),this._rightPhoneCue.connect(this._nodes.merger,0,3)):!0===this._leftCue||!0===this._rightCue?(this._leftPhoneCue&&this._rightPhoneCue&&(this._leftPhoneCue.disconnect(this._nodes.merger,0,2),this._rightPhoneCue.disconnect(this._nodes.merger,0,3)),!0===this._leftCue&&(e="left"),this._leftPhoneCue=this._players[e].output,this._rightPhoneCue=this._players[e].output,this._leftPhoneCue.connect(this._nodes.merger,0,2),this._rightPhoneCue.connect(this._nodes.merger,0,3)):(this._leftPhoneCue&&this._rightPhoneCue&&(this._leftPhoneCue.disconnect(this._nodes.merger,0,2),this._rightPhoneCue.disconnect(this._nodes.merger,0,3)),this._leftPhoneCue=null,this._rightPhoneCue=null)}},{key:"toggleMasterPhoneCue",value:function(e){CustomEvents.publish("Player/MasterCuePhones",e)}},{key:"setMasterVolume",value:function(e){e<.66?this._nodes.outputGain.gain.value=.7079*e/.66:e>.66?this._nodes.outputGain.gain.value=(e-.66)*(1.995-.7079)/(1-.66)+.7079:.66===e&&(this._nodes.outputGain.gain.value=.7079),CustomEvents.publish("Master/Volume",{gain:this._nodes.outputGain.gain.value,value:e})}},{key:"attachPlayer",value:function(e,t){this._players[e]=t}},{key:"getMasterInput",value:function(e){return this._nodes["".concat(e,"Gain")]}},{key:"getMasterOutput",value:function(){return this._nodes.outputGain}},{key:"audioContext",get:function(){return this._audioCtx}}])&&r(t.prototype,n),s&&r(t,s),e}();function u(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t.name,this._player=t.player,this._activeMode=0,this._hotCues=[-1,-1,-1,-1,-1,-1,-1,-1]}var t,n,s;return t=e,(n=[{key:"togglePad",value:function(e,t,n,s){if(CustomEvents.publish("Pad/Set",{name:e,pad:n+1,shift:!1,active:127===t.raw[2]}),"push"===t.value&&0===this._activeMode)if(-1===this._hotCues[n]){var i=Meax.ui.getClosestBeatTime(e);this._hotCues[n]=i,CustomEvents.publish("Pad/SaveHotCue",{name:e,pad:n+1,active:127===t.raw[2],time:i,color:Enums.DefaultColors.hotCue})}else this._player.currentTime=this._hotCues[n]}},{key:"shiftTogglePad",value:function(e,t,n){CustomEvents.publish("Pad/ShiftSet",{name:e,pad:n+1,shift:!0,active:127===t.raw[2]}),"push"===t.value&&0===this._activeMode&&-1!==this._hotCues[n]&&(CustomEvents.publish("Pad/RemoveHotCue",{name:e,pad:n+1,active:127===t.raw[2]}),-1!==this._hotCues[n]&&(this._hotCues[n]=-1))}},{key:"setPadType",value:function(e,t,n){0===this._activeMode&&this._activeMode!==n&&(this._hotCues=[-1,-1,-1,-1,-1,-1,-1,-1],CustomEvents.publish("Pad/ClearSelection",{name:e,pad:n+1,active:127===t.raw[2]})),this._type=Enums.PerformanceType[n+1],this._activeMode=n+1,CustomEvents.publish("Pad/Type",{name:e,pad:n+1,value:127===t.raw[2]})}},{key:"getHotCue",value:function(e){return e<this._hotCues.length?this._hotCues[e]:null}}])&&u(t.prototype,n),s&&u(t,s),e}();function h(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t.name,this._audioCtx=t.ac,this._outputNode=t.output,this._nodes={source:null,low:null,mid:null,high:null,filterLow:null,filterHigh:null,gain:null,trimGain:null},this._endEvtId=-1,this._progressRafId=-1,this._isPlaying=!1,this._gainValue=1,this._lowFiltered=!1,this._highFiltered=!1,this._pad=null,this._setupNodes(),this._buildPerformancePads()}var t,n,s;return t=e,(n=[{key:"loadTrack",value:function(e){var t=this;return new Promise((function(n){t._isPlaying&&(t.stopPlayback(),CustomEvents.removeEvent(t._endEvtId),t._isPlaying=!0),t._player.src=e.url,t._player.addEventListener("loadedmetadata",(function s(){t._player.removeEventListener("loadedmetadata",s),t._audioCtx.resume(),!0===t._isPlaying&&t.resumePlayback(),t._endEvtId=CustomEvents.addEvent("ended",t._player,t._trackEnded,t),e.duration=t._player.duration,n(e)}))}))}},{key:"_setupNodes",value:function(){this._player=document.createElement("AUDIO"),this._nodes.source=this._audioCtx.createMediaElementSource(this._player),this._nodes.gain=this._audioCtx.createGain(),this._nodes.gain.gain.value=this._gainValue,this._nodes.trimGain=this._audioCtx.createGain(),this._nodes.trimGain.gain.value=.7079,console.log(this._nodes.trimGain.gain.maxValue),this._nodes.low=this._audioCtx.createBiquadFilter(),this._nodes.low.type="lowshelf",this._nodes.low.frequency.value=320,this._nodes.low.gain.value=0,this._nodes.mid=this._audioCtx.createBiquadFilter(),this._nodes.mid.type="peaking",this._nodes.mid.frequency.value=1e3,this._nodes.mid.Q.value=.5,this._nodes.mid.gain.value=0,this._nodes.high=this._audioCtx.createBiquadFilter(),this._nodes.high.type="highshelf",this._nodes.high.frequency.value=3200,this._nodes.high.gain.value=0,this._nodes.filterLow=this._audioCtx.createBiquadFilter(),this._nodes.filterLow.type="lowpass",this._nodes.filterLow.Q.value=0,this._nodes.filterHigh=this._audioCtx.createBiquadFilter(),this._nodes.filterHigh.type="highpass",this._nodes.filterHigh.Q.value=0,this._connectNodes()}},{key:"_connectNodes",value:function(){this._nodes.source.connect(this._nodes.low),this._nodes.low.connect(this._nodes.mid),this._nodes.mid.connect(this._nodes.high),this._nodes.high.connect(this._nodes.gain),this._nodes.gain.connect(this._nodes.trimGain),this._nodes.trimGain.connect(this._outputNode)}},{key:"_buildPerformancePads",value:function(){this._pad=new c({name:this._name,player:this.player})}},{key:"togglePlayback",value:function(){return!0===this._isPlaying?(this.pausePlayback(),0):(this.resumePlayback(),127)}},{key:"startPlayback",value:function(){this._player&&this._player.src&&(this._isPlaying=!0,this.resumePlayback())}},{key:"resumePlayback",value:function(){this._player&&this._player.src&&(this._isPlaying=!0,this._player.play(),this._startProgressClock(),CustomEvents.publish("Player/Play",{name:this._name}))}},{key:"pausePlayback",value:function(){this._player&&this._player.src&&(this._isPlaying=!1,this._player.pause(),this._stopProgressClock(),CustomEvents.publish("Player/Pause",{name:this._name}))}},{key:"stopPlayback",value:function(){this._player&&this._player.src&&(this.pausePlayback(),this._player.currentTime=0,console.log("stopPlayback"))}},{key:"_trackEnded",value:function(){console.log("track ended"),this.stopPlayback(),CustomEvents.publish("Player/Progress",{name:this._name,value:{progress:0,duration:this._player.duration}})}},{key:"_startProgressClock",value:function(){CustomEvents.publish("Player/Progress",{name:this._name,value:{progress:this._player.currentTime,duration:this._player.duration}}),this._progressRafId=requestAnimationFrame(this._startProgressClock.bind(this))}},{key:"_stopProgressClock",value:function(){cancelAnimationFrame(this._progressRafId),this._progressRafId=-1}},{key:"setVolume",value:function(e){this._gainValue=e,this._nodes.gain&&(this._nodes.gain.gain.value=e),CustomEvents.publish("Player/SetVolume",{name:this._name,value:e})}},{key:"setTrimVolume",value:function(e){var t=Utils.convertKnobValue(e,100);this._nodes.trimGain.gain.value=1+t,CustomEvents.publish("Player/TrimGain",{name:this._name,value:e})}},{key:"setProgress",value:function(e){this._player.currentTime=this._player.duration*e}},{key:"adjustProgressSlow",value:function(e){this._adjustProgress(e,.1)}},{key:"adjustProgressFast",value:function(e){this._adjustProgress(e,10)}},{key:"_adjustProgress",value:function(e,t){var n=this;this._player&&this._player.src&&("increase"===e?(this._player.playbackRate+=t,setTimeout((function(){return n._player.playbackRate-=t}),10)):"decrease"===e&&(this._player.playbackRate-t<=0?this._player.currentTime-=this._player.duration/this._audioCtx.sampleRate*t:(this._player.playbackRate-=t,setTimeout((function(){return n._player.playbackRate+=t}),10))))}},{key:"setTempo",value:function(e){if(this._player&&this._player.src){var t=Utils.convertKnobValue(e,16);this._player.playbackRate=1+t,CustomEvents.publish("Player/SetTempo",{name:this._name,value:t})}}},{key:"setHighEQ",value:function(e){this._setEQ("high",e)}},{key:"setMidEQ",value:function(e){this._setEQ("mid",e)}},{key:"setLowEQ",value:function(e){this._setEQ("low",e)}},{key:"_setEQ",value:function(e,t){if(this._player&&this._player.src){var n=Utils.convertKnobValue(t,26);this._nodes[e].gain.value=100*n}CustomEvents.publish("Player/EQ",{name:this._name,type:e,value:t})}},{key:"setFilter",value:function(e){var t=this;return new Promise((function(n){if(.5!==e){if(t._nodes.high.disconnect(0),e<.5){t._lowFiltered=!0,t._highFiltered=!1,t._nodes.high.connect(t._nodes.filterLow),t._nodes.filterLow.connect(t._nodes.gain);var s=Utils.convertKnobValue(e,21730);t._nodes.filterLow.frequency.value=22050+100*s}else if(e>.5){t._lowFiltered=!1,t._highFiltered=!0,t._nodes.high.connect(t._nodes.filterHigh),t._nodes.filterHigh.connect(t._nodes.gain);var i=Utils.convertKnobValue(e,22050);t._nodes.filterLow.frequency.value=100*i}}else!0===t._lowFiltered?(t._lowFiltered=!1,t._nodes.filterLow.disconnect(0),t._nodes.high.connect(t._nodes.gain)):!0===t._highFiltered&&(t._highFiltered=!1,t._nodes.filterHigh.disconnect(0),t._nodes.high.connect(t._nodes.gain));n(e)}))}},{key:"setPad",value:function(e,t,n,s){!1===s?this._pad.togglePad(e,t,n-1):this._pad.shiftTogglePad(e,t,n-1)}},{key:"setPadType",value:function(e,t,n){this._pad.setPadType(e,t,n-1)}},{key:"getHotCue",value:function(e){return this._pad.getHotCue(e)}},{key:"sourceNode",get:function(){return this._nodes.trimGain}},{key:"output",get:function(){return this._nodes.source}},{key:"player",get:function(){return this._player}},{key:"playing",get:function(){return this._isPlaying}}])&&h(t.prototype,n),s&&h(t,s),e}();function m(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._master=null,this._leftPlayer=null,this._rightPlayer=null,this._init()}var t,n,s;return t=e,(n=[{key:"_init",value:function(){this._master=new l,this._leftPlayer=new d({name:"left",ac:this._master.audioContext,output:this._master.getMasterInput("left")}),this._rightPlayer=new d({name:"right",ac:this._master.audioContext,output:this._master.getMasterInput("right")}),this._master.attachPlayer("left",this._leftPlayer),this._master.attachPlayer("right",this._rightPlayer)}},{key:"addTrack",value:function(e,t){if("left"===e||"right"===e)return this["_".concat(e,"Player")].loadTrack(t)}},{key:"togglePlayback",value:function(e,t){if("left"===e||"right"===e)return this["_".concat(e,"Player")].togglePlayback(t)}},{key:"setMasterVolume",value:function(e){this._master.setMasterVolume(e)}},{key:"setVolume",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(e,"Player")].setVolume(t)}},{key:"setTrimVolume",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(e,"Player")].setTrimVolume(t)}},{key:"setProgress",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(e,"Player")].setProgress(t)}},{key:"adjustProgressSlow",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(e,"Player")].adjustProgressSlow(t)}},{key:"adjustProgressFast",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(e,"Player")].adjustProgressFast(t)}},{key:"setTempo",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(e,"Player")].setTempo(t)}},{key:"setHighEQ",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(e,"Player")].setHighEQ(t)}},{key:"setMidEQ",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(e,"Player")].setMidEQ(t)}},{key:"setLowEQ",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(e,"Player")].setLowEQ(t)}},{key:"setFilter",value:function(e,t){if("left"===e||"right"===e)return this["_".concat(e,"Player")].setFilter(t)}},{key:"setCuePhone",value:function(e,t){"left"!==e&&"right"!==e||this._master.togglePhoneCue(e,t)}},{key:"setMasterCuePhone",value:function(e){this._master.toggleMasterPhoneCue(e)}},{key:"crossFade",value:function(e){this._master.crossFade(e)}},{key:"setPad",value:function(e,t,n,s){"left"!==e&&"right"!==e||this["_".concat(e,"Player")].setPad(e,t,n,s)}},{key:"setPadType",value:function(e,t,n){var s=this;return new Promise((function(i){"left"!==e&&"right"!==e||s["_".concat(e,"Player")].setPadType(e,t,n),i()}))}},{key:"getPlayer",value:function(e){return this["_".concat(e,"Player")].player}},{key:"getMasterPlayer",value:function(){return this._master.player}},{key:"getMasterOutputNode",value:function(e){return this._master.getMasterOutput()}},{key:"getPlayerOutputNode",value:function(e){return this["_".concat(e,"Player")].sourceNode}},{key:"getHotCue",value:function(e,t){return this["_".concat(e,"Player")].getHotCue(t)}},{key:"audioContext",get:function(){return this._master.audioContext}}])&&m(t.prototype,n),s&&m(t,s),e}();function f(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=t.target,this._type=t.type,this._side=t.side,this._fromZero=t.fromZero||!1,this._meterContainer=document.createElement("DIV"),this._dial=document.createElement("DIV"),this._pin=document.createElement("DIV"),this._label=document.createElement("P"),this._meterContainer.classList.add("meter-container"),this._dial.classList.add("dial"),this._pin.classList.add("pin"),this._dial.style.transform="rotate(0)",this._pin.style.transform="rotate(-45deg)",this._label.innerHTML=this._type.toUpperCase(),this._meterContainer.appendChild(this._dial),this._meterContainer.appendChild(this._pin),this._container.appendChild(this._meterContainer),this._container.appendChild(this._label),this._gauge=document.querySelector("progress-ring.".concat(this._type,"-").concat(this._side)),this._gauge.setAttribute("progress",0)}var t,n,s;return t=e,(n=[{key:"setValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._fromZero||t){var n=2*(e-.5)*135,s=100*e*(3/4);this._dial.style.transform="rotate(".concat(n,"deg)"),this._pin.style.transform="rotate(".concat(n-45,"deg)"),this._gauge.setAttribute("progress","".concat(s))}else if(e>.5){var i=2*(e-.5)*135,a=100*(e-.5)*(3/4);this._dial.style.transform="rotate(".concat(i,"deg)"),this._pin.style.transform="rotate(".concat(i-45,"deg)"),this._gauge.setAttribute("progress","".concat(a))}else if(e<.5){var o=135*(1-2*e),r=100*(.5-e)*(3/4);this._dial.style.transform="rotate(".concat(-o,"deg)"),this._pin.style.transform="rotate(".concat(-o-45,"deg)"),this._gauge.setAttribute("progress","".concat(-r))}else.5===e&&(this._dial.style.transform="rotate(0)",this._pin.style.transform="rotate(-45deg)")}}])&&f(t.prototype,n),s&&f(t,s),e}();function v(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._headphoneCueMaster=null,this._headphonesMasterOn=!1,this._knobs={headphone:null,mix:null,master:null},this._peakMeter=null,this._init(),this._addEvents()}var t,n,s;return t=e,(n=[{key:"_init",value:function(){this._headphoneCueMaster=document.getElementById("headphones-master"),this._knobs.master=new p({target:document.getElementById("master-global"),type:"master",side:"global"}),this._knobs.headphone=new p({target:document.getElementById("headphone-global"),type:"headphone",side:"global",fromZero:!0}),this._knobs.mix=new p({target:document.getElementById("mix-global"),type:"mix",side:"global"}),this._peakMeter=new AudioVisualizer({type:"peakmeter",player:Meax.pc.getPlayer("left"),audioContext:Meax.pc.audioContext,inputNode:Meax.pc.getMasterOutputNode(),renderTo:document.querySelector("#peakmeter-master"),fftSize:8192,merged:!1,orientation:"horizontal"})}},{key:"_addEvents",value:function(){var e=this;CustomEvents.addEvent("click",this._headphoneCueMaster,(function(){e.toggleMasterPhoneCue(),Meax.pc.setMasterCuePhone({raw:[150,99,e._headphoneCueMaster.classList.contains("enabled")?127:0]})}),this)}},{key:"toggleMasterPhoneCue",value:function(){this._headphonesMasterOn?this._headphoneCueMaster.classList.remove("enabled"):this._headphoneCueMaster.classList.add("enabled"),this._headphonesMasterOn=!this._headphonesMasterOn}},{key:"setMasterVolume",value:function(e){this._knobs.master.setValue(e.value)}},{key:"setHeadphoneVolume",value:function(e){this._knobs.headphone.setValue(e,!0)}},{key:"setMix",value:function(e){this._knobs.mix.setValue(e)}}])&&v(t.prototype,n),s&&v(t,s),e}();function g(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t.url,this._rootElement=null,this._loadingOverlay=document.createElement("DIV"),this._loadingOverlay.className="loading-overlay",this._loadTemplate()}var t,n,s;return t=e,(n=[{key:"_loadTemplate",value:function(){var e=this;Meax.kom.getText(this._url).then((function(t){e._rootElement=Utils.parseHTMLFragment(t),e._loadingOverlay.appendChild(e._rootElement),e.open(),e._fillAttributes()}))}},{key:"_fillAttributes",value:function(){}},{key:"open",value:function(){document.body.appendChild(this._loadingOverlay),CustomEvents.addEvent("click",this._loadingOverlay,this.close,this)}},{key:"close",value:function(e){(e&&e.target===this._loadingOverlay||!e)&&(document.body.removeChild(this._loadingOverlay),CustomEvents.removeEvent("click",this._loadingOverlay,this.close,this))}}])&&g(t.prototype,n),s&&g(t,s),e}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=w(e);if(t){var i=w(this).constructor;n=Reflect.construct(s,arguments,i)}else n=s.apply(this,arguments);return T(this,n)}}function T(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(a,e);var t,n,s,i=P(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._name=e.name,t._title=e.title,t._hotCue=e.hotCue,t._dom={title:null,color:null,update:null},t}return t=a,(n=[{key:"_fillAttributes",value:function(){this._dom.title=document.getElementById("hot-cue-title"),this._dom.color=document.getElementById("hot-cue-color"),this._dom.update=document.getElementById("edit-hot-cue-submit"),this._dom.color.value=this._hotCue.color,this._dom.title.value=this._title,CustomEvents.addEvent("click",this._dom.update,this.updateHotCue,this)}},{key:"updateHotCue",value:function(){this._hotCue.color=this._dom.color.value,this._hotCue.title=this._dom.title.value,Meax.ui.updateHotCue(this._name,this._hotCue),CustomEvents.removeEvent("click",this._dom.update,this.updateHotCue,this),this.close()}}])&&E(t.prototype,n),s&&E(t,s),a}(b);function O(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var I=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t.name,this._activeType=t.type,this._activeTypeIndex=0,this._dom={ctrl1:null,ctrl2:null,ctrl3:null,ctrl4:null,pad1:null,pad2:null,pad3:null,pad4:null,pad5:null,pad6:null,pad7:null,pad8:null},this._getElements()}var t,n,s;return t=e,(n=[{key:"_getElements",value:function(){for(var e=0;e<4;++e)this._dom["ctrl".concat(e+1)]=document.getElementById("ctrl".concat(e+1,"-").concat(this._name));for(var t=0;t<8;++t)this._dom["pad".concat(t+1)]=document.getElementById("pad".concat(t+1,"-").concat(this._name)),CustomEvents.addEvent("click",this._dom["pad".concat(t+1)],this._padClicked,this)}},{key:"_padClicked",value:function(e){var t=e.target.id.split("-")[0].charAt(3);t||(t=e.target.parentNode.id.split("-")[0].charAt(3)),Meax.pc.setPad(this._name,{value:"push",raw:[0,0,127]},t,e.shiftKey)}},{key:"setPadControl",value:function(e){for(var t=0;t<4;++t)this._dom["ctrl".concat(t+1)].classList.remove("enabled","shift-enabled");if(e.pad%2==0){this._dom["ctrl".concat(e.pad/2+1)].classList.add("enabled");for(var n=0;n<4;++n)this._dom["ctrl".concat(n+1)].firstChild.innerHTML=Enums.PerformanceType[2*n].toUpperCase()}else{this._dom["ctrl".concat((e.pad-1)/2+1)].classList.add("shift-enabled");for(var s=0;s<4;++s)this._dom["ctrl".concat(s+1)].firstChild.innerHTML=Enums.PerformanceType[2*s+1].toUpperCase()}}},{key:"setPad",value:function(e){if(0!==this._activeTypeIndex){var t="enabled";e.shift&&(t="shift-enabled"),!0===e.active?this._dom["pad".concat(e.pad)].classList.add(t):this._dom["pad".concat(e.pad)].classList.remove("enabled","shift-enabled")}}},{key:"clearPadSelection",value:function(){for(var e=0;e<8;++e)this._dom["pad".concat(e+1)].classList.remove("enabled","shift-enabled"),this._dom["pad".concat(e+1)].innerHTML=""}},{key:"saveHotCue",value:function(e){var t=this,n=document.createElement("DIV"),s=document.createElement("P"),i=document.createElement("P");n.classList.add("pad".concat(e.pad-1,"-hotcue-icon")),s.classList.add("pad".concat(e.pad-1,"-hotcue-title")),i.classList.add("pad".concat(e.pad-1,"-hotcue-value")),n.style.backgroundColor=Enums.DefaultColors.hotCue,n.innerHTML=e.pad,i.innerHTML=Utils.secondsToTimecode(Utils.precisionRound(e.time,2)),CustomEvents.addEvent("click",n,(function(n){n.stopPropagation(),new M({name:t._name,title:s.innerHTML,url:"assets/html/EditCueModal.html",hotCue:e})})),this._dom["pad".concat(e.pad)].appendChild(n),this._dom["pad".concat(e.pad)].appendChild(s),this._dom["pad".concat(e.pad)].appendChild(i),this._dom["pad".concat(e.pad)].classList.add("enabled")}},{key:"removeHotCue",value:function(e){this._dom["pad".concat(e.pad)].classList.remove("enabled"),this._dom["pad".concat(e.pad)].innerHTML=""}},{key:"updateHotCue",value:function(e,t){var n=this._dom["pad".concat(t.pad)].children[0],s=this._dom["pad".concat(t.pad)].children[1];n.style.backgroundColor=t.color,s.innerHTML=t.title}},{key:"setPadType",value:function(e){this._type=Enums.PerformanceType[e.pad],this._activeTypeIndex=e.pad,this.setPadControl(e)}}])&&O(t.prototype,n),s&&O(t,s),e}();function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=S(e);if(t){var i=S(this).constructor;n=Reflect.construct(s,arguments,i)}else n=s.apply(this,arguments);return H(this,n)}}function H(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(a,e);var t,n,s,i=x(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._name=e.name,t._colors=e.colors,t._dom={title:null,background:null,track:null,mainBeat:null,subBeat:null,update:null},t}return t=a,(n=[{key:"_fillAttributes",value:function(){this._dom.title=document.getElementById("edit-timeline-colors-title"),this._dom.background=document.getElementById("timeline-background-color"),this._dom.track=document.getElementById("timeline-track-color"),this._dom.mainBeat=document.getElementById("timeline-main-beats-color"),this._dom.subBeat=document.getElementById("timeline-sub-beats-color"),this._dom.update=document.getElementById("edit-timeline-colors-submit"),this._dom.background.value=this._colors.background,this._dom.track.value=this._colors.track,this._dom.mainBeat.value=this._colors.mainBeat,this._dom.subBeat.value=this._colors.subBeat,this._dom.title.innerHTML="".concat(this._name.charAt(0).toUpperCase()).concat(this._name.slice(1)," Timeline Colors"),CustomEvents.addEvent("click",this._dom.update,this.updateColors,this)}},{key:"updateColors",value:function(){Meax.sm.save("".concat(this._name,"-timeline-color-background"),this._dom.background.value),Meax.sm.save("".concat(this._name,"-timeline-color-track"),this._dom.track.value),Meax.sm.save("".concat(this._name,"-timeline-color-main-beat"),this._dom.mainBeat.value),Meax.sm.save("".concat(this._name,"-timeline-color-sub-beat"),this._dom.subBeat.value),Meax.ui.timelineColorUpdate({name:this._name,background:this._dom.background.value,track:this._dom.track.value,mainBeat:this._dom.mainBeat.value,subBeat:this._dom.subBeat.value}),CustomEvents.removeEvent("click",this._dom.update,this.updateColors,this),this.close()}}])&&R(t.prototype,n),s&&R(t,s),a}(b);function F(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var D=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t,this._timeline=null,this._align={top:null,center:null,bottom:null},this._controls={speedPlus:null,speedLess:null,scaleMore:null,scaleLess:null,colors:null},this._colors={background:Meax.sm.get("".concat(this._name,"-timeline-color-background"))||"#1D1E25",track:Meax.sm.get("".concat(this._name,"-timeline-color-track"))||"#12B31D",mainBeat:Meax.sm.get("".concat(this._name,"-timeline-color-main-beat"))||"#FF6B67",subBeat:Meax.sm.get("".concat(this._name,"-timeline-color-sub-beat"))||"#56D45B"},this._alignValue=Meax.sm.get("".concat(this._name,"-timeline-alignment"))||"center",this._speed=Meax.sm.get("".concat(this._name,"-timeline-speed"))||8,this._scale=Meax.sm.get("".concat(this._name,"-timeline-scale"))||90,this._buildTimeline(),this._setControls()}var t,n,s;return t=e,(n=[{key:"_buildTimeline",value:function(){this._timeline&&(document.querySelector("#timeline-container-".concat(this._name)).innerHTML="",this._timeline.destroy(),this._timeline=null),this._timeline=new AudioVisualizer({type:"timeline",player:Meax.pc.getPlayer(this._name),audioContext:Meax.pc.audioContext,inputNode:Meax.pc.getPlayerOutputNode(this._name),renderTo:document.querySelector("#timeline-container-".concat(this._name)),fftSize:1024,speed:this._speed,beat:{offset:.15053,bpm:85,timeSignature:4},wave:{align:this._alignValue,scale:this._scale/100},colors:{background:this._colors.background,track:this._colors.track,mainBeat:this._colors.mainBeat,subBeat:this._colors.subBeat},hotCues:[]})}},{key:"_setControls",value:function(){this._align.top=document.getElementById("timeline-".concat(this._name,"-align-top")),this._align.center=document.getElementById("timeline-".concat(this._name,"-align-center")),this._align.bottom=document.getElementById("timeline-".concat(this._name,"-align-bottom")),CustomEvents.addEvent("click",this._align.top,this.alignUpdate,this),CustomEvents.addEvent("click",this._align.center,this.alignUpdate,this),CustomEvents.addEvent("click",this._align.bottom,this.alignUpdate,this),this._controls.speedPlus=document.getElementById("timeline-".concat(this._name,"-speed-plus")),this._controls.speedLess=document.getElementById("timeline-".concat(this._name,"-speed-less")),this._controls.scaleMore=document.getElementById("timeline-".concat(this._name,"-scale-more")),this._controls.scaleLess=document.getElementById("timeline-".concat(this._name,"-scale-less")),this._controls.colors=document.getElementById("timeline-".concat(this._name,"-colors")),this._align[this._alignValue].classList.add("selected"),1===this._speed?this._controls.speedPlus.classList.add("disabled"):17===this._speed&&this._controls.speedLess.classList.add("disabled"),100===this._scale?this._controls.scaleMore.classList.add("disabled"):10===this._scale&&this._controls.scaleLess.classList.add("disabled"),CustomEvents.addEvent("click",this._controls.speedPlus,this.speedUpdate,this),CustomEvents.addEvent("click",this._controls.speedLess,this.speedUpdate,this),CustomEvents.addEvent("click",this._controls.scaleMore,this.scaleUpdate,this),CustomEvents.addEvent("click",this._controls.scaleLess,this.scaleUpdate,this),CustomEvents.addEvent("click",this._controls.colors,this.colorUpdateModal,this)}},{key:"alignUpdate",value:function(e){this._align[this._alignValue].classList.remove("selected"),this._alignValue=e.target.id.split("-")[3],this._align[this._alignValue].classList.add("selected"),Meax.sm.save("".concat(this._name,"-timeline-alignment"),this._alignValue),this._buildTimeline()}},{key:"speedUpdate",value:function(e){var t=this,n=function(){Meax.sm.save("".concat(t._name,"-timeline-speed"),t._speed),t._buildTimeline()};if(-1!==e.target.id.indexOf("plus")){if(this._controls.speedPlus.classList.add("disabled"),1===this._speed)return;if(this._speed-=2,this._speed<=0)return this._speed=1,void n();n()}else{if(this._controls.speedLess.classList.add("disabled"),17===this._speed)return;if(this._speed+=2,this._speed>=17)return this._speed=17,void n();n()}this._controls.speedLess.classList.remove("disabled"),this._controls.speedPlus.classList.remove("disabled")}},{key:"scaleUpdate",value:function(){var e=this,t=function(){Meax.sm.save("".concat(e._name,"-timeline-scale"),e._scale),e._buildTimeline()};if(-1!==event.target.id.indexOf("more")){if(this._controls.scaleMore.classList.add("disabled"),100===this._scale)return;if(this._scale+=10,this._scale>=100)return this._scale=100,void t();t()}else{if(this._controls.scaleLess.classList.add("disabled"),10===this._scale)return;if(this._scale-=10,this._scale<=10)return this._scale=10,void t();t()}this._controls.scaleMore.classList.remove("disabled"),this._controls.scaleLess.classList.remove("disabled")}},{key:"colorUpdateModal",value:function(){new A({name:this._name,colors:this._colors,url:"assets/html/TimelineColorsModal.html"})}},{key:"setTimelineColors",value:function(e){this._colors.background=e.background,this._colors.track=e.track,this._colors.mainBeat=e.mainBeat,this._colors.subBeat=e.subBeat,this._buildTimeline()}},{key:"getClosestBeatTime",value:function(){return this._timeline.getClosestBeat(!0)}},{key:"setHotCue",value:function(e){return this._timeline.setHotCuePoint({color:Enums.DefaultColors.hotCue,label:e.pad})}},{key:"removeHotCue",value:function(e){e&&this._timeline.removeHotCuePoint(e)}},{key:"updateHotCue",value:function(e,t){e&&this._timeline.updateHotCuePoint(e,t)}}])&&F(t.prototype,n),s&&F(t,s),e}();function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=K(e);if(t){var i=K(this).constructor;n=Reflect.construct(s,arguments,i)}else n=s.apply(this,arguments);return U(this,n)}}function U(e,t){return!t||"object"!==N(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(a,e);var t,n,s,i=G(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._name=e.name,t._colors=e.colors,t._dom={title:null,background:null,track:null,progress:null,progressBar:null,update:null},t._align={top:null,center:null,bottom:null},t._alignValue=e.align||"bottom",t}return t=a,(n=[{key:"_fillAttributes",value:function(){this._dom.title=document.getElementById("edit-waveform-options-title"),this._dom.background=document.getElementById("waveform-background-color"),this._dom.track=document.getElementById("waveform-track-color"),this._dom.progress=document.getElementById("waveform-progress-color"),this._dom.progressBar=document.getElementById("waveform-progress-bar-color"),this._dom.update=document.getElementById("edit-waveform-options-submit"),this._align.top=document.getElementById("waveform-align-top"),this._align.center=document.getElementById("waveform-align-center"),this._align.bottom=document.getElementById("waveform-align-bottom"),this._align[this._alignValue].classList.add("selected"),this._dom.background.value=this._colors.background,this._dom.track.value=this._colors.track,this._dom.progress.value=this._colors.progress,this._dom.progressBar.value=this._colors.progressBar,this._dom.title.innerHTML="".concat(this._name.charAt(0).toUpperCase()).concat(this._name.slice(1)," Waveform Options"),CustomEvents.addEvent("click",this._align.top,this.alignUpdate,this),CustomEvents.addEvent("click",this._align.center,this.alignUpdate,this),CustomEvents.addEvent("click",this._align.bottom,this.alignUpdate,this),CustomEvents.addEvent("click",this._dom.update,this.updateOptions,this)}},{key:"updateOptions",value:function(){Meax.sm.save("".concat(this._name,"-waveform-color-background"),this._dom.background.value),Meax.sm.save("".concat(this._name,"-waveform-color-track"),this._dom.track.value),Meax.sm.save("".concat(this._name,"-waveform-color-progress"),this._dom.progress.value),Meax.sm.save("".concat(this._name,"-waveform-color-progress-bar"),this._dom.progressBar.value),Meax.sm.save("".concat(this._name,"-waveform-align"),this._alignValue),Meax.ui.waveformOptionUpdate({name:this._name,background:this._dom.background.value,track:this._dom.track.value,progress:this._dom.progress.value,progressBar:this._dom.progressBar.value,align:this._alignValue}),CustomEvents.removeEvent("click",this._dom.update,this.updateOptions,this),this.close()}},{key:"alignUpdate",value:function(e){this._align[this._alignValue].classList.remove("selected"),this._alignValue=e.target.id.split("-")[2],this._align[this._alignValue].classList.add("selected"),Meax.sm.save("".concat(this._name,"-waveform-alignment"),this._alignValue)}}])&&j(t.prototype,n),s&&j(t,s),a}(b);function W(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t,this._waveform=null,this._controls={modal:null,progressBar:null},this._colors={background:Meax.sm.get("".concat(this._name,"-waveform-color-background"))||"#1D1E25",track:Meax.sm.get("".concat(this._name,"-waveform-color-track"))||"#FFFFFF",progress:Meax.sm.get("".concat(this._name,"-waveform-color-progress"))||"#56D45B",progressBar:Meax.sm.get("".concat(this._name,"-waveform-color-progress-bar"))||"#FF6B67"},this._alignValue=Meax.sm.get("".concat(this._name,"-waveform-alignment"))||"bottom",this._buildWaveform(),this._setControls(),this._updateModalPosition()}var t,n,s;return t=e,(n=[{key:"_buildWaveform",value:function(){this._waveform&&(document.querySelector("#waveform-".concat(this._name)).innerHTML="",this._waveform.destroy(),this._waveform=null),this._waveform=new AudioVisualizer({type:"waveform",player:Meax.pc.getPlayer(this._name),renderTo:document.querySelector("#waveform-".concat(this._name)),fftSize:1024,audioContext:Meax.pc.audioContext,inputNode:Meax.pc.getPlayerOutputNode(this._name),animation:"gradient",wave:{align:this._alignValue,barWidth:1,barMarginScale:0},colors:{background:this._colors.background,track:this._colors.track,progress:this._colors.progress},hotCues:this._hotCues})}},{key:"_setControls",value:function(){var e=this;this._controls.modal=document.getElementById("waveform-".concat(this._name,"-colors")),this._controls.progressBar=document.getElementById("track-waveform-progress-".concat(this._name)),CustomEvents.addEvent("click",this._controls.modal,this.optionsUpdateModal,this),CustomEvents.addEvent("click",this._controls.progressBar.parentNode,(function(t){var n=t.offsetX/e._controls.progressBar.parentNode.offsetWidth;Meax.pc.setProgress(e._name,n)}),this),CustomEvents.addEvent("timeupdate",Meax.pc.getPlayer(this._name),(function(t){e.updateProgress({progress:Meax.pc.getPlayer(e._name).currentTime,duration:Meax.pc.getPlayer(e._name).duration})}),this)}},{key:"_updateModalPosition",value:function(){"top"===this._alignValue?this._controls.modal.classList.add("bottom"):this._controls.modal.classList.remove("bottom")}},{key:"optionsUpdateModal",value:function(e){e.stopPropagation(),new q({name:this._name,colors:this._colors,align:this._alignValue,url:"assets/html/WaveformOptionsModal.html"})}},{key:"updateProgress",value:function(e){this._controls.progressBar.style.width="".concat(e.progress/e.duration*100,"%")}},{key:"setHotCue",value:function(e){e&&this._waveform.setHotCuePoint(e)}},{key:"removeHotCue",value:function(e){e&&this._waveform.removeHotCuePoint(e)}},{key:"updateHotCue",value:function(e,t){e&&this._waveform.updateHotCuePoint(e,t)}},{key:"setWaveformOptions",value:function(e){this._colors.background=e.background,this._colors.track=e.track,this._colors.progress=e.progress,this._colors.progressBar=e.progressBar,this._alignValue=e.align,this._updateModalPosition(),this._buildWaveform()}}])&&W(t.prototype,n),s&&W(t,s),e}();function z(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var J=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t,this._dom={title:null,artist:null,bpm:null,appliedBpm:null,key:null,progress:null,duration:null,play:null,faderTrack:null,faderProgress:null,cuePhone:null,waveformColors:null},this._knobs={gain:null,filter:null},this._bpm=0,this._hotCues=[],this._timelineController=new D(this._name),this._waveformController=new Q(this._name),this._performancePad=new I({name:this._name,type:"hotcue"}),this._getElements(),this._buildKnobs(),this._addEvents(),this._setEventSubscriptions()}var t,n,s;return t=e,(n=[{key:"_getElements",value:function(){this._dom.title=document.getElementById("track-title-".concat(this._name)),this._dom.artist=document.getElementById("track-artist-".concat(this._name)),this._dom.bpm=document.getElementById("track-bpm-".concat(this._name)),this._dom.appliedBpm=document.getElementById("track-applied-bpm-".concat(this._name)),this._dom.key=document.getElementById("track-key-".concat(this._name)),this._dom.progress=document.getElementById("track-current-time-".concat(this._name)),this._dom.duration=document.getElementById("track-duration-".concat(this._name)),this._dom.play=document.getElementById("play-".concat(this._name)),this._dom.faderTrack=document.getElementById("fader-track-".concat(this._name)),this._dom.faderProgress=document.getElementById("fader-progress-".concat(this._name)),this._dom.cuePhone=document.getElementById("headphones-".concat(this._name)),this._dom.waveformColors=document.getElementById("waveform-".concat(this._name,"-colors"))}},{key:"_buildKnobs",value:function(){this._knobs.filter=new p({target:document.getElementById("eq-filter-".concat(this._name)),type:"filter",side:this._name}),this._knobs.gain=new p({target:document.getElementById("eq-gain-".concat(this._name)),type:"gain",side:this._name})}},{key:"_addEvents",value:function(){var e=this;CustomEvents.addEvent("click",this._dom.play,(function(){Meax.pc.togglePlayback(e._name)}),this),CustomEvents.addEvent("click",this._dom.cuePhone,(function(){Meax.pc.setCuePhone(e._name,{raw:["left"===e._name?144:145,84,e._dom.cuePhone.classList.contains("enabled")?127:0]})}),this),CustomEvents.addEvent("timeupdate",Meax.pc.getPlayer(this._name),(function(t){e.updateProgress({progress:Meax.pc.getPlayer(e._name).currentTime,duration:Meax.pc.getPlayer(e._name).duration})}),this)}},{key:"_setEventSubscriptions",value:function(){CustomEvents.subscribe("Player/TrimGain",this._updateTrimGain.bind(this))}},{key:"setFilter",value:function(e){this._knobs.filter.setValue(e)}},{key:"_updateTrimGain",value:function(e){this._name===e.name&&this._knobs.gain.setValue(e.value)}},{key:"setVolume",value:function(e){this._dom.faderProgress.style.top="".concat(66-(54*e+6),"px")}},{key:"setTempo",value:function(e){this._dom.appliedBpm.innerHTML=this._bpm+this._bpm*e}},{key:"setPlay",value:function(){this._dom.play.src="./assets/img/player/pause.svg",this._dom.play.classList.add("playing")}},{key:"setPause",value:function(){this._dom.play.src="./assets/img/player/play.svg",this._dom.play.classList.remove("playing")}},{key:"loadTrack",value:function(e){this._dom.title.innerHTML=e.title,this._dom.artist.innerHTML=e.artist,this._dom.bpm.innerHTML=e.bpm,this._dom.key.innerHTML=e.key,this._dom.progress.innerHTML=Utils.secondsToTimecode(0,!0),this._dom.duration.innerHTML=Utils.secondsToTimecode(e.duration,!0),this._dom.appliedBpm.innerHTML=e.bpm,this._bpm=parseInt(e.bpm)}},{key:"updateProgress",value:function(e){this._dom.progress.innerHTML=Utils.secondsToTimecode(e.progress,!0),this._waveformController.updateProgress(e)}},{key:"updateCuePhone",value:function(e){127===e.raw[2]?this._dom.cuePhone.classList.add("enabled"):this._dom.cuePhone.classList.remove("enabled")}},{key:"setPad",value:function(e){this._performancePad.setPad(e)}},{key:"clearPadSelection",value:function(e){this._performancePad.clearPadSelection()}},{key:"saveHotCue",value:function(e){this._performancePad.saveHotCue(e);var t=this._timelineController.setHotCue(e);this._waveformController.setHotCue(t),this._hotCues.push(t)}},{key:"removeHotCue",value:function(e){for(var t=null,n=0;n<this._hotCues.length;++n)if(this._hotCues[n].label===e.pad){t=this._hotCues[n],this._hotCues.splice(n,1);break}this._performancePad.removeHotCue(e),this._timelineController.removeHotCue(t),this._waveformController.removeHotCue(t)}},{key:"updateHotCue",value:function(e){for(var t=null,n=0;n<this._hotCues.length;++n)if(this._hotCues[n].label===e.pad){t=this._hotCues[n];break}t&&(this._performancePad.updateHotCue(t,e),this._timelineController.updateHotCue(t,e),this._waveformController.updateHotCue(t,e))}},{key:"setPadType",value:function(e){this._performancePad.setPadType(e)}},{key:"timelineColorUpdate",value:function(e){this._timelineController.setTimelineColors(e)}},{key:"waveformOptionUpdate",value:function(e){this._waveformController.setWaveformOptions(e)}},{key:"getClosestBeatTime",value:function(){return this._timelineController.getClosestBeatTime()}}])&&z(t.prototype,n),s&&z(t,s),e}();function X(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._knobs={},this._crossfaderTrack=null,this._crossfaderProgress=null,this._peakMeter={left:null,right:null},this._buildCrossfader(),this._buildKnobs()}var t,n,s;return t=e,(n=[{key:"_buildCrossfader",value:function(){this._crossfaderTrack=document.getElementById("crossfader-track"),this._crossfaderProgress=document.getElementById("crossfader-progress")}},{key:"_buildKnobs",value:function(){for(var e=["left","right"],t=["high","mid","low"],n=0;n<e.length;++n)for(var s=0;s<t.length;++s)this._knobs["".concat(t[s]).concat(e[n],"EQ")]=new p({target:document.getElementById("eq-".concat(t[s],"-").concat(e[n])),type:t[s],side:e[n]});this._peakMeter.left=new AudioVisualizer({type:"peakmeter",player:Meax.pc.getPlayer("left"),audioContext:Meax.pc.audioContext,inputNode:Meax.pc.getPlayerOutputNode("left"),renderTo:document.querySelector("#peakmeter-left"),fftSize:8192,merged:!0,orientation:"vertical",colors:{background:"#1D1E25",min:"#56D45B",step0:"#AFF2B3",step1:"#FFAD67",step2:"#FF6B67",max:"#FFBAB8"}}),this._peakMeter.right=new AudioVisualizer({type:"peakmeter",player:Meax.pc.getPlayer("right"),audioContext:Meax.pc.audioContext,inputNode:Meax.pc.getPlayerOutputNode("right"),renderTo:document.querySelector("#peakmeter-right"),fftSize:8192,merged:!0,orientation:"vertical",colors:{background:"#1D1E25",min:"#56D45B",step0:"#AFF2B3",step1:"#FFAD67",step2:"#FF6B67",max:"#FFBAB8"}})}},{key:"updateCrossfader",value:function(e){this._crossfaderProgress.style.right="calc(".concat(100-100*e.value,"% - 5px)")}},{key:"updateKnob",value:function(e){"left"!==e.name&&"right"!==e.name||this._knobs["".concat(e.type).concat(e.name,"EQ")].setValue(e.value)}}])&&X(t.prototype,n),s&&X(t,s),e}();function Z(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var $=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._dom={container:null},this._tracks=[],this._selected=0,this._init()}var t,n,s;return t=e,(n=[{key:"_init",value:function(){var e=this;this._dom.container=document.getElementById("playlist-container");for(var t=[{url:"./assets/audio/Teminite - 01 - Elevate.mp3",title:"Elevate",artist:"Teminite",bpm:"170",key:"Fm"},{url:"./assets/audio/Teminite - 02 - Hot Fizz.mp3",title:"Hot Fizz",artist:"Teminite",bpm:"105",key:"G♯m"},{url:"./assets/audio/Teminite - 03 - Don't Stop.mp3",title:"Don't Stop",artist:"Teminite",bpm:"140",key:"Fm"}],n=function(n){var s=document.createElement("DIV"),i=document.createElement("DIV"),a=document.createElement("DIV");s.classList.add("playlist-track"),s.innerHTML="".concat(t[n].artist," - ").concat(t[n].title),s.dataset.id=n,s.info=t[n],i.id="inject-left",a.id="inject-right",i.innerHTML='<img src="assets/img/inject.svg" alt="inject-left">',a.innerHTML='<img src="assets/img/inject.svg" alt="inject-right">';var o=function(){var e=this.id.split("-")[1];Meax.pc.addTrack(e,s.info).then((function(t){Meax.ui.addTrack(e,t)}))};CustomEvents.addEvent("click",i,o,i),CustomEvents.addEvent("click",a,o,a),s.appendChild(a),s.appendChild(i),e._dom.container.appendChild(s),e._tracks.push(s)},s=0;s<t.length;++s)n(s);this._tracks[0].classList.add("selected"),this._selected=0}},{key:"navigateInPlaylist",value:function(e){"increase"===e?(this._tracks[this._selected].classList.remove("selected"),this._selected=(this._selected+1)%this._tracks.length,this._tracks[this._selected].classList.add("selected")):"decrease"===e&&(this._tracks[this._selected].classList.remove("selected"),this._selected=(this._selected-1+this._tracks.length)%this._tracks.length,this._tracks[this._selected].classList.add("selected"))}},{key:"selectedTrack",get:function(){return this._tracks[this._selected].info}}])&&Z(t.prototype,n),s&&Z(t,s),e}();function ee(e){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function te(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function ne(e,t){return!t||"object"!==ee(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function se(e){var t="function"==typeof Map?new Map:void 0;return(se=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,s)}function s(){return ie(e,arguments,re(this).constructor)}return s.prototype=Object.create(e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),oe(s,e)})(e)}function ie(e,t,n){return(ie=ae()?Reflect.construct:function(e,t,n){var s=[null];s.push.apply(s,t);var i=new(Function.bind.apply(e,s));return n&&oe(i,n.prototype),i}).apply(null,arguments)}function ae(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var le=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(r,e);var t,n,s,i,a,o=(t=r,n=ae(),function(){var e,s=re(t);if(n){var i=re(this).constructor;e=Reflect.construct(s,arguments,i)}else e=s.apply(this,arguments);return ne(this,e)});function r(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),e=o.call(this);var t=window.getComputedStyle(document.documentElement).getPropertyValue("--ring-radius"),n=t-6+1.5;return e._circumference=2*n*Math.PI,e.setAttribute("radius",t),e._root=e.attachShadow({mode:"open"}),e._root.innerHTML='\n      <svg height="'.concat(2*t,'" width="').concat(2*t,'" >\n         <circle\n           stroke="#56D45B"\n           stroke-dasharray="').concat(e._circumference," ").concat(e._circumference,'"\n           style="stroke-dashoffset:').concat(e._circumference,'"\n           stroke-width="').concat(3,'"\n           fill="transparent"\n           r="').concat(n,'"\n           cx="').concat(t,'"\n           cy="').concat(t,'"\n        />\n      </svg>\n      <style>\n        circle {\n          transform: rotate(-90deg);\n          transform-origin: 50% 50%;\n        }\n      </style>\n    '),e}return s=r,a=[{key:"observedAttributes",get:function(){return["progress"]}}],(i=[{key:"setProgress",value:function(e){var t=this._circumference-e/100*this._circumference;this._root.querySelector("circle").style.strokeDashoffset=t}},{key:"attributeChangedCallback",value:function(e,t,n){"progress"===e&&this.setProgress(n)}}])&&te(s.prototype,i),a&&te(s,a),r}(se(HTMLElement));function ue(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ce=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),window.customElements.define("progress-ring",le),this._master=new y,this._leftDeck=new J("left"),this._rightDeck=new J("right"),this._mixer=new Y,this._playlist=new $,this._setEventSubscriptions()}var t,n,s;return t=e,(n=[{key:"_setEventSubscriptions",value:function(){CustomEvents.subscribe("Player/SetVolume",this._setVolume.bind(this)),CustomEvents.subscribe("Player/SetTempo",this._setTempo.bind(this)),CustomEvents.subscribe("Player/Play",this._setPlay.bind(this)),CustomEvents.subscribe("Player/Pause",this._setPause.bind(this)),CustomEvents.subscribe("Player/Progress",this._updateProgress.bind(this)),CustomEvents.subscribe("Player/EQ",this._updateKnobs.bind(this)),CustomEvents.subscribe("Player/CuePhones",this._cuePhones.bind(this)),CustomEvents.subscribe("Player/Crossfade",this._crossfade.bind(this)),CustomEvents.subscribe("Master/Volume",this._setMasterVolume.bind(this)),CustomEvents.subscribe("Pad/Set",this._setPad.bind(this)),CustomEvents.subscribe("Pad/ShiftSet",this._setPad.bind(this)),CustomEvents.subscribe("Pad/Fire",this._firePad.bind(this)),CustomEvents.subscribe("Pad/ClearSelection",this._clearPadSelection.bind(this)),CustomEvents.subscribe("Pad/SaveHotCue",this._saveHotCue.bind(this)),CustomEvents.subscribe("Pad/RemoveHotCue",this._removeHotCue.bind(this)),CustomEvents.subscribe("Pad/Type",this._setPadType.bind(this))}},{key:"addTrack",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(e,"Deck")].loadTrack(t)}},{key:"setFilter",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(e,"Deck")].setFilter(t)}},{key:"_setPlay",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].setPlay()}},{key:"_setPause",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].setPause()}},{key:"_setVolume",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].setVolume(e.value)}},{key:"_setTempo",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].setTempo(e.value)}},{key:"_updateProgress",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].updateProgress(e.value)}},{key:"_updateKnobs",value:function(e){"left"!==e.name&&"right"!==e.name||this._mixer.updateKnob(e)}},{key:"_cuePhones",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].updateCuePhone(e)}},{key:"_crossfade",value:function(e){this._mixer.updateCrossfader(e)}},{key:"toggleMasterPhoneCue",value:function(){this._master.toggleMasterPhoneCue()}},{key:"_setMasterVolume",value:function(e){this._master.setMasterVolume(e)}},{key:"setHeadphoneMix",value:function(e){this._master.setMix(e)}},{key:"setHeadphoneVolume",value:function(e){this._master.setHeadphoneVolume(e)}},{key:"_setPad",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].setPad(e)}},{key:"_firePad",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].setPad(e)}},{key:"_clearPadSelection",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].clearPadSelection(e)}},{key:"_saveHotCue",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].saveHotCue(e)}},{key:"_removeHotCue",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].removeHotCue(e)}},{key:"updateHotCue",value:function(e,t){"left"!==e&&"right"!==e||this["_".concat(t.name,"Deck")].updateHotCue(t)}},{key:"_setPadType",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].setPadType(e)}},{key:"navigateInPlaylist",value:function(e,t){"left"!==e&&"right"!==e||this._playlist.navigateInPlaylist(t)}},{key:"timelineColorUpdate",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].timelineColorUpdate(e)}},{key:"waveformOptionUpdate",value:function(e){"left"!==e.name&&"right"!==e.name||this["_".concat(e.name,"Deck")].waveformOptionUpdate(e)}},{key:"getSelectedTrack",value:function(){return this._playlist.selectedTrack}},{key:"getClosestBeatTime",value:function(e){if("left"===e||"right"===e)return this["_".concat(e,"Deck")].getClosestBeatTime()}}])&&ue(t.prototype,n),s&&ue(t,s),e}(),he={ElementType:Object.freeze({BUTTON:"BUTTON",KNOB_HIGH:"KNOB_HIGH",KNOB_LOW:"KNOB_LOW",JOGWHEEL:"JOGWHEEL",ROTARY:"ROTARY",SELECT:"SELECT"}),Components:Object.freeze({DECK_LEFT:"0",DECK_RIGHT:"1",MIXER:"2",EFFECTS:"3",PAD_LEFT:"4",PAD_LEFT_SHIFT:"5",PAD_RIGHT:"6",PAD_RIGHT_SHIFT:"7"}),Commands:Object.freeze({PLAY:"001",CUE_PHONES_LEFT:"018",PERFORMANCE_TAB_1:"020",PERFORMANCE_TAB_2:"021",PERFORMANCE_TAB_3:"022",PERFORMANCE_TAB_4:"023",PERFORMANCE_TAB_5:"024",PERFORMANCE_TAB_6:"025",PERFORMANCE_TAB_7:"026",PERFORMANCE_TAB_8:"027",JOGWHEEL_SLOW:"028",JOGWHEEL_FAST:"029",TEMPO:"031",VOLUME:"033",VOLUME_TRIM:"035",HIGH_EQ:"037",MID_EQ:"039",LOW_EQ:"041",CUE_PHONE_MASTER:"043",LEFT_LOAD_TRACK:"045",RIGHT_LOAD_TRACK:"047",SELECTION_ROTARY:"051",MASTER_VOLUME:"053",HEADPHONE_MIX:"055",HEADPHONE_VOLUME:"057",LEFT_FILTER:"059",RIGHT_FILTER:"061",CROSSFADER:"063",PAD_1:"078",PAD_2:"079",PAD_3:"080",PAD_4:"081",PAD_5:"082",PAD_6:"083",PAD_7:"084",PAD_8:"085"}),PerformanceType:["hotcue","keyboard","beatloop","fx1","beatjump","fx2","sampler","keyshift"],HttpStatusCode:{OK:200,NOT_FOUND:404,FORBIDDEN:403,INTERNAL_ERROR:500},DefaultColors:{hotCue:"#F7A637"}};function de(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var me=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._csrfToken=this._getCsrfCookie(),this._headers=this._createRequestHeaders()}var t,n,s;return t=e,(n=[{key:"_getCsrfCookie",value:function(){if(document.cookie&&""!==document.cookie)for(var e=document.cookie.split(";"),t=0;t<e.length;++t){var n=e[t].trim().match(/(\w+)=(.*)/);if(void 0!==n&&"csrftoken"===n[1])return decodeURIComponent(n[2])}return""}},{key:"_createRequestHeaders",value:function(){return[["Content-Type","application/json; charset=UTF-8"],["Accept","application/json"],["X-CSRFToken",this._csrfToken]]}},{key:"_getErrorCodeFromHTTPStatus",value:function(e){return e===he.NOT_FOUND?"B_KOM_NOT_FOUND":e===he.FORBIDDEN?"B_KOM_ACCESS_FORBIDDEN":e===he.INTERNAL_ERROR?"B_KOM_INTERNAL_ERROR":"B_KOM_UNKNOWN_ERROR"}},{key:"_resolveAsJSON",value:function(e){var t=this;return new Promise((function(n,s){e?e.ok?n(e.json()):s(t._getErrorCodeFromHTTPStatus(e.status)):s("F_KOM_MISSING_ARGUMENT")}))}},{key:"_resolveAsText",value:function(e){var t=this;return new Promise((function(n,s){e?e.ok?n(e.text()):s(t._getErrorCodeFromHTTPStatus(e.status)):s("F_KOM_MISSING_ARGUMENT")}))}},{key:"_resolveAsRaw",value:function(e){var t=this;return new Promise((function(n,s){e?e.status===he.OK?n(e.responseText):s(t._getErrorCodeFromHTTPStatus(e.status)):s("F_KOM_MISSING_ARGUMENT")}))}},{key:"checkValidity",value:function(){var e=this;return new Promise((function(t,n){""!==e._csrfToken&&null!==e._headers.length?t():n("F_KOM_INIT_FAILED")}))}},{key:"get",value:function(e){var t=this;return new Promise((function(n,s){var i={method:"GET",headers:new Headers([t._headers[0]])};fetch(e,i).then(t._resolveAsJSON).then(n).catch(s)}))}},{key:"getText",value:function(e){var t=this;return new Promise((function(n,s){var i={method:"GET",headers:new Headers([t._headers[0]])};fetch(e,i).then(t._resolveAsText.bind(t)).then(n).catch(s)}))}},{key:"getRaw",value:function(e){var t=this;return new Promise((function(n,s){var i=new XMLHttpRequest;i.open("GET",e,!0),i.overrideMimeType("text/plain; charset=x-user-defined"),i.onreadystatechange=function(e){4===e.target.readyState&&t._resolveAsRaw(e.target).then(n).catch(s)},i.onerror=s("F_KOM_XHR_ERROR"),i.send()}))}},{key:"post",value:function(e,t){var n=this;return new Promise((function(s,i){var a={method:"POST",headers:new Headers(n._headers),body:JSON.stringify(t)};fetch(e,a).then(n._resolveAsJSON).then(s).catch(i)}))}}])&&de(t.prototype,n),s&&de(t,s),e}();function _e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var fe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,s;return t=e,(n=[{key:"precisionRound",value:function(e,t){var n=Math.pow(10,t||0);return Math.round(e*n)/n}},{key:"secondsToTimecode",value:function(e,t){var n={h:0,m:0,s:0,ms:0};return n.h=Math.floor(e/3600),n.m=Math.floor((e-3600*n.h)/60),n.s=Math.floor(e-3600*n.h-60*n.m),n.ms=Math.floor(100*(e-60*n.m-n.s)),n.h<10&&(n.h="0".concat(n.h)),n.m<10&&(n.m="0".concat(n.m)),n.s<10&&(n.s="0".concat(n.s)),n.ms<10&&(n.ms="0".concat(n.ms)),n.h>0?"".concat(n.h,":").concat(n.m,":").concat(n.s):!0===t?"".concat(n.m,":").concat(n.s,":").concat(n.ms):"".concat(n.m,":").concat(n.s)}},{key:"convertKnobValue",value:function(e,t){var n=e*t/100,s=t/200,i=0;return n<s?i=this.precisionRound(2*-(s-n),2):n>s&&(i=this.precisionRound(2*(n-s),2)),i}},{key:"parseHTMLFragment",value:function(e){return(new DOMParser).parseFromString(e,"text/html").body.firstChild}}])&&_e(t.prototype,n),s&&_e(t,s),e}();function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ye(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ge=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];ve(this,e),"boolean"!=typeof t&&(t=!1),this._debug=t,this._idIncrementor=5678*Math.floor(Math.random()*Math.floor(256)),this._regularEvents=[],this._customEvents={},this.version="1.2.0"}var t,n,s;return t=e,(n=[{key:"destroy",value:function(){var e=this;this._raise("log","CustomEvents.destroy"),this.removeAllEvents(),Object.keys(this).forEach((function(t){delete e[t]}))}},{key:"addEvent",value:function(e,t,n){var s=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this._raise("log","CustomEvents.addEvent: ".concat(e," ").concat(t," ").concat(n," ").concat(i," ").concat(a)),null==e||null==t||null==n)return this._raise("error","CustomEvents.addEvent: Missing mandatory arguments"),!1;var o=function(){s._raise("error","CustomEvents.addEvent: Wrong type for argument")};return"string"!=typeof e||"object"!==pe(t)||"function"!=typeof n||null!=i&&"object"!==pe(i)||null!=a&&"object"!==pe(a)&&"boolean"!=typeof a?(o(),!1):(n=n.bind(i),this._regularEvents.push({id:this._idIncrementor,element:t,eventName:e,scope:i,callback:n,options:a}),t.addEventListener(e,n,a),this._idIncrementor++)}},{key:"removeEvent",value:function(e){if(this._raise("log","Events.removeEvent: ".concat(e)),null==e)return this._raise("error","CustomEvents.removeEvent: Missing mandatory arguments"),!1;if("number"!=typeof e)return this._raise("error","CustomEvents.removeEvent: Wrong type for argument"),!1;for(var t=!1,n=this._regularEvents.length-1;n>=0;--n)this._regularEvents[n].id===e&&(t=!0,this._clearRegularEvent(n));return t}},{key:"removeAllEvents",value:function(){this._raise("log","CustomEvents.removeAllEvents");for(var e=!1,t=this._regularEvents.length>0,n=this._regularEvents.length-1;n>=0;--n)this._clearRegularEvent(n);return 0===this._regularEvents.length&&t&&(e=!0),e}},{key:"_clearRegularEvent",value:function(e){if(this._raise("log","CustomEvents._clearRegularEvent: ".concat(e)),null==e)return this._raise("error","CustomEvents._clearRegularEvent: Missing mandatory argument"),!1;if("number"!=typeof e)return this._raise("error","CustomEvents._clearRegularEvent: Wrong type for argument"),!1;if(this._regularEvents[e]){var t=this._regularEvents[e];return t.element.removeEventListener(t.eventName,t.callback,t.options),this._regularEvents.splice(e,1),!0}return!1}},{key:"subscribe",value:function(e,t){var n=this,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._raise("log","CustomEvents.subscribe: ".concat(e," ").concat(t," ").concat(s)),null==e||null==t)return this._raise("error","CustomEvents.subscribe","Missing mandatory arguments"),!1;var i=function(){n._raise("error","CustomEvents.subscribe: Wrong type for argument")};return"string"!=typeof e||"function"!=typeof t||null!=s&&"boolean"!=typeof s?(i(),!1):(this._customEvents[e]||(this._customEvents[e]=[]),this._customEvents[e].push({id:this._idIncrementor,name:e,os:s,callback:t}),this._idIncrementor++)}},{key:"unsubscribe",value:function(e){if(this._raise("log","CustomEvents.unsubscribe: ".concat(e)),null==e)return this._raise("error","CustomEvents.unsubscribe: Missing mandatory arguments"),!1;if("number"!=typeof e)return this._raise("error","CustomEvents.unsubscribe: Wrong type for argument"),!1;for(var t=!1,n=Object.keys(this._customEvents),s=n.length-1;s>=0;--s)for(var i=this._customEvents[n[s]],a=0;a<i.length;++a)if(i[a].id===e){this._raise("log","CustomEvents.unsubscribe: subscription found\n",i[a],"\nSubscription n°".concat(e," for ").concat(i.name," has been removed")),t=!0,i.splice(a,1),0===i.length&&delete this._customEvents[n[s]];break}return t}},{key:"unsubscribeAllFor",value:function(e){if(this._raise("log","CustomEvents.unsubscribeAllFor: ".concat(e)),null==e)return this._raise("error","CustomEvents.unsubscribeAllFor: Missing mandatory arguments"),!1;if("string"!=typeof e)return this._raise("error","CustomEvents.unsubscribeAllFor: Wrong type for argument"),!1;for(var t=!1,n=Object.keys(this._customEvents),s=0;s<n.length;++s)if(n[s]===e)for(var i=this._customEvents[n[s]],a=i.length-1;a>=0;--a)t=!0,i.splice(a,1),0===i.length&&delete this._customEvents[n[s]];return t}},{key:"publish",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._raise("log","CustomEvents.publish: ".concat(e," ").concat(t)),null==e)return this._raise("error","CustomEvents.publish: Missing mandatory arguments"),!1;if("string"!=typeof e||void 0!==t&&"object"!==pe(t))return this._raise("error","CustomEvents.publish: Wrong type for argument"),!1;for(var n=!1,s=Object.keys(this._customEvents),i=0;i<s.length;++i)if(s[i]===e){n=!0;for(var a=this._customEvents[s[i]],o=a.length-1;o>=0;--o)this._raise("log","CustomEvents.publish: fire callback for ".concat(e,", subscription n°").concat(a[o].id),a[o]),a[o].callback(t),a[o].os&&(this._raise("log","CustomEvents.publish: remove subscription because one shot usage is done"),a.splice(o,1),0===a.length&&delete this._customEvents[s[i]])}return n}},{key:"_raise",value:function(e,t){this._debug&&console[e](t)}}])&&ye(t.prototype,n),s&&ye(t,s),e}();function be(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}window.CustomEvents=new ge,window.Utils=new fe,window.Enums=he;var ke=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._sm=null,this._dh=null,this._pc=null,this._ui=null,this._kom=null}var t,n,s;return t=e,(n=[{key:"init",value:function(){this._sm=new i,this._dh=new o({onEvent:this._onControllerEvent.bind(this)}),this._pc=new _,this._ui=new ce,this._kom=new me}},{key:"_onControllerEvent",value:function(e){console.log(e);var t=e.id.charAt(0),n=e.id.slice(1);t===he.Components.MIXER?this._mixerEvents(e,n):t===he.Components.DECK_LEFT?this._deckEvents("left",e,n):t===he.Components.DECK_RIGHT?this._deckEvents("right",e,n):t===he.Components.PAD_LEFT?this._padEvents("left",e,n,!1):t===he.Components.PAD_LEFT_SHIFT?this._padEvents("left",e,n,!0):t===he.Components.PAD_RIGHT?this._padEvents("right",e,n,!1):t===he.Components.PAD_RIGHT_SHIFT&&this._padEvents("right",e,n,!0)}},{key:"_mixerEvents",value:function(e,t){var n=this;t===he.Commands.LEFT_LOAD_TRACK&&"push"===e.value?this._pc.addTrack("left",this._ui.getSelectedTrack()).then((function(e){n._ui.addTrack("left",e)})):t===he.Commands.RIGHT_LOAD_TRACK&&"push"===e.value?this._pc.addTrack("right",this._ui.getSelectedTrack()).then((function(e){n._ui.addTrack("right",e)})):t===he.Commands.SELECTION_ROTARY?this._ui.navigateInPlaylist("left",e.value):t===he.Commands.LEFT_FILTER?this._pc.setFilter("left",e.value).then((function(e){n._ui.setFilter("left",e)})):t===he.Commands.RIGHT_FILTER?this._pc.setFilter("right",e.value).then((function(e){n._ui.setFilter("right",e)})):t===he.Commands.CROSSFADER?this._pc.crossFade(e.value):t===he.Commands.CUE_PHONE_MASTER&&"push"===e.value?this._ui.toggleMasterPhoneCue():t===he.Commands.MASTER_VOLUME?this._pc.setMasterVolume(e.value):t===he.Commands.HEADPHONE_MIX?this._ui.setHeadphoneMix(e.value):t===he.Commands.HEADPHONE_VOLUME&&this._ui.setHeadphoneVolume(e.value)}},{key:"_deckEvents",value:function(e,t,n){if(n===he.Commands.PLAY&&"push"===t.value){var s=this._pc.togglePlayback(e,t);this._dh.sendMIDIMessage([t.raw[0],t.raw[1],s])}else n===he.Commands.CUE_PHONES_LEFT&&"push"===t.value?this._pc.setCuePhone(e,t):n===he.Commands.PERFORMANCE_TAB_1?this._pc.setPadType(e,t,0):n===he.Commands.PERFORMANCE_TAB_2?this._pc.setPadType(e,t,1):n===he.Commands.PERFORMANCE_TAB_3?this._pc.setPadType(e,t,2):n===he.Commands.PERFORMANCE_TAB_4?this._pc.setPadType(e,t,3):n===he.Commands.PERFORMANCE_TAB_5?this._pc.setPadType(e,t,4):n===he.Commands.PERFORMANCE_TAB_6?this._pc.setPadType(e,t,5):n===he.Commands.PERFORMANCE_TAB_7?this._pc.setPadType(e,t,6):n===he.Commands.PERFORMANCE_TAB_8?this._pc.setPadType(e,t,7):n===he.Commands.VOLUME?this._pc.setVolume(e,t.value):n===he.Commands.VOLUME_TRIM?this._pc.setTrimVolume(e,t.value):n===he.Commands.TEMPO?this._pc.setTempo(e,t.value):n===he.Commands.JOGWHEEL_SLOW?this._pc.adjustProgressSlow(e,t.value):n===he.Commands.JOGWHEEL_FAST?this._pc.adjustProgressFast(e,t.value):n===he.Commands.HIGH_EQ?this._pc.setHighEQ(e,t.value):n===he.Commands.MID_EQ?this._pc.setMidEQ(e,t.value):n===he.Commands.LOW_EQ&&this._pc.setLowEQ(e,t.value)}},{key:"_padEvents",value:function(e,t,n,s){this._dh.sendMIDIMessage(t.raw),n===he.Commands.PAD_1?this._pc.setPad(e,t,1,s):n===he.Commands.PAD_2?this._pc.setPad(e,t,2,s):n===he.Commands.PAD_3?this._pc.setPad(e,t,3,s):n===he.Commands.PAD_4?this._pc.setPad(e,t,4,s):n===he.Commands.PAD_5?this._pc.setPad(e,t,5,s):n===he.Commands.PAD_6?this._pc.setPad(e,t,6,s):n===he.Commands.PAD_7?this._pc.setPad(e,t,7,s):n===he.Commands.PAD_8&&this._pc.setPad(e,t,8,s)}},{key:"sm",get:function(){return this._sm}},{key:"pc",get:function(){return this._pc}},{key:"dh",get:function(){return this._dh}},{key:"ui",get:function(){return this._ui}},{key:"kom",get:function(){return this._kom}}])&&be(t.prototype,n),s&&be(t,s),e}();window.Meax=new ke;t.default=ke}]);